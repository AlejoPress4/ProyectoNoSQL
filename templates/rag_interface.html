<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline RAG - Sistema Completo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <style>
        .rag-response {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .context-section {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .source-badge {
            background: rgba(0, 123, 255, 0.1);
            border: 1px solid #007bff;
            color: #007bff;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 0.25rem;
            display: inline-block;
        }

        .pipeline-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .pipeline-step {
            flex: 1;
            text-align: center;
            padding: 1rem;
            background: #e9ecef;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .pipeline-step.active {
            background: #007bff;
            color: white;
            transform: scale(1.05);
        }

        .pipeline-step.complete {
            background: #28a745;
            color: white;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-robot me-2"></i>RAG Tech - Pipeline Completo
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Inicio</a>
                <a class="nav-link" href="/ragtech">B칰squeda Simple</a>
                <a class="nav-link active" href="/rag-interface">Pipeline RAG</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold text-primary">
                <i class="fas fa-brain me-3"></i>Pipeline RAG Completo
            </h1>
            <p class="lead">Recuperaci칩n Sem치ntica + Generaci칩n con LLM</p>
        </div>

        <!-- Status del Pipeline -->
        <div class="pipeline-status">
            <div class="pipeline-step" id="step-input">
                <i class="fas fa-edit fa-2x mb-2"></i>
                <h6>1. Entrada</h6>
                <small>Pregunta del usuario</small>
            </div>
            <div class="pipeline-step" id="step-retrieval">
                <i class="fas fa-search fa-2x mb-2"></i>
                <h6>2. Recuperaci칩n</h6>
                <small>B칰squeda vectorial</small>
            </div>
            <div class="pipeline-step" id="step-generation">
                <i class="fas fa-brain fa-2x mb-2"></i>
                <h6>3. Generaci칩n</h6>
                <small>LLM + Contexto</small>
            </div>
            <div class="pipeline-step" id="step-response">
                <i class="fas fa-check fa-2x mb-2"></i>
                <h6>4. Respuesta</h6>
                <small>Resultado final</small>
            </div>
        </div>

        <!-- Formulario RAG -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-question-circle me-2"></i>Haz tu Pregunta al Sistema RAG</h5>
            </div>
            <div class="card-body">
                <form id="ragForm">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="ragQuery" class="form-label">Pregunta</label>
                                <textarea class="form-control" id="ragQuery" rows="3"
                                    placeholder="Ej: 쮺u치l es el mejor smartphone para gaming y por qu칠?"
                                    aria-describedby="ragQueryHelp" required></textarea>
                                <div class="form-text" id="ragQueryHelp">
                                    El sistema buscar치 informaci칩n relevante y generar치 una respuesta contextualizada.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Configuraci칩n</label>
                                <div class="row">
                                    <div class="col-6">
                                        <label class="form-label" for="maxProducts">Productos</label>
                                        <select class="form-select" id="maxProducts"
                                            aria-label="N칰mero m치ximo de productos">
                                            <option value="3">3 productos</option>
                                            <option value="5" selected>5 productos</option>
                                            <option value="10">10 productos</option>
                                        </select>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label" for="maxReviews">Rese침as</label>
                                        <select class="form-select" id="maxReviews"
                                            aria-label="N칰mero m치ximo de rese침as">
                                            <option value="0">Sin rese침as</option>
                                            <option value="3" selected>3 rese침as</option>
                                            <option value="5">5 rese침as</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="includeReviews" checked>
                                    <label class="form-check-label" for="includeReviews">
                                        Incluir rese침as de usuarios
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg" id="ragSubmit">
                        <i class="fas fa-rocket me-2"></i>Ejecutar Pipeline RAG
                    </button>
                </form>
            </div>
        </div>

        <!-- Ejemplos de consultas -->
        <div class="card mt-4">
            <div class="card-header">
                <h6><i class="fas fa-lightbulb me-2"></i>Ejemplos de Consultas RAG</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <button class="btn btn-outline-primary btn-sm me-2 mb-2 example-query"
                            data-query="쮺u치l es el mejor smartphone con buena c치mara seg칰n las rese침as?">
                            An치lisis de smartphones
                        </button>
                        <button class="btn btn-outline-success btn-sm me-2 mb-2 example-query"
                            data-query="Compara las laptops disponibles para gaming y recomienda la mejor opci칩n">
                            Comparaci칩n de laptops
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-outline-info btn-sm me-2 mb-2 example-query"
                            data-query="쯈u칠 auriculares tienen mejor relaci칩n calidad-precio y por qu칠?">
                            Recomendaci칩n de auriculares
                        </button>
                        <button class="btn btn-outline-warning btn-sm me-2 mb-2 example-query"
                            data-query="Explica las tendencias en tablets seg칰n los productos disponibles">
                            Tendencias en tablets
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="ragLoading" class="text-center my-5" style="display: none;">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Procesando...</span>
            </div>
            <h5 class="mt-3">Ejecutando Pipeline RAG...</h5>
            <p class="text-muted">Recuperando contexto y generando respuesta...</p>
        </div>

        <!-- Resultados RAG -->
        <div id="ragResults" style="display: none;">
            <div class="rag-response">
                <h3><i class="fas fa-brain me-2"></i>Respuesta Generada por IA</h3>
                <div id="ragResponseContent" class="fs-5 lh-base"></div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-cog me-2"></i>
                            <small><span id="modelUsed">Modelo utilizado</span></small>
                        </div>
                    </div>
                    <div class="col-md-6 text-end">
                        <small>
                            <i class="fas fa-database me-1"></i>
                            <span id="contextStats">Contexto utilizado</span>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Contexto utilizado -->
            <div class="context-section">
                <h5><i class="fas fa-database me-2"></i>Contexto Utilizado por el LLM</h5>
                <div class="row">
                    <div class="col-md-6">
                        <h6>游님 Productos Relevantes (<span id="productCount">0</span>)</h6>
                        <div id="contextProducts"></div>
                    </div>
                    <div class="col-md-6">
                        <h6>游눫 Rese침as Relevantes (<span id="reviewCount">0</span>)</h6>
                        <div id="contextReviews"></div>
                    </div>
                </div>
            </div>

            <!-- Fuentes -->
            <div class="mt-4">
                <h6><i class="fas fa-link me-2"></i>Fuentes de Informaci칩n</h6>
                <div id="sourcesList"></div>
            </div>
        </div>

        <!-- Error -->
        <div id="ragError" class="alert alert-danger" style="display: none;" role="alert">
            <h5><i class="fas fa-exclamation-triangle me-2"></i>Error en Pipeline RAG</h5>
            <p id="errorMessage">Ha ocurrido un error inesperado.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='rag-interface.js') }}"></script>
</body>

</html>